<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>Book – Modular Architecture</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter&family=Roboto&family=Open+Sans&family=Merriweather&family=Libre+Baskerville&display=swap"
      rel="stylesheet"
    />

    <!-- Предзагрузка -->
    <link rel="preload" fetchpriority="high" as="image" href="images/backgrounds/bg-cover.webp" type="image/webp">
    <link rel="preload" href="fonts/tolkiencyr.woff2" as="font" crossorigin="anonymous">

    <!-- Главный CSS (импортирует все модули) -->
    <link rel="stylesheet" href="css/index.css" />
  </head>

  <body>
    <!-- Фоновые изображения глав (два слоя для кроссфейда) -->
    <div class="chapter-bg">
      <div class="bg" data-active="false"></div>
      <div class="bg" data-active="false"></div>
    </div>

    <!-- Панель отладки -->
    <div class="debug-info" id="debugInfo">
      <div>State: <span id="debugState">-</span></div>
      <div>Pages: <span id="debugTotal">0</span></div>
      <div>Current: <span id="debugCurrent">0</span></div>
      <div>Cache: <span id="debugCache">0</span></div>
      <div>Memory: <span id="debugMemory">-</span></div>
      <div>Listeners: <span id="debugListeners">0</span></div>
    </div>

    <div class="scene">
      <div class="book-wrap" data-state="closed" id="book-wrap">
        <div
          class="book"
          data-state="closed"
          id="book"
          role="region"
          aria-label="Книга"
        >
          <!-- Обложка -->
          <div class="cover" id="cover">
            <div class="cover-front">
              <h1><span>О хоббитах</span> <span>Дж.Р.Р.Толкин</span></h1>
            </div>
            <div class="cover-back"></div>
          </div>

          <!-- Край страниц -->
          <div class="pages-edge" aria-hidden="true"></div>

          <!-- Активные страницы (A-буфер) -->
          <div class="page" data-side="left" data-active="true" id="leftA" aria-live="polite">
            <div class="page-inner"></div>
          </div>
          <div class="page" data-side="right" data-active="true" id="rightA" aria-live="polite">
            <div class="page-inner"></div>
          </div>

          <!-- Буферные страницы (B-буфер) -->
          <div class="page" data-side="left" data-buffer="true" id="leftB" aria-hidden="true">
            <div class="page-inner"></div>
          </div>
          <div class="page" data-side="right" data-buffer="true" id="rightB" aria-hidden="true">
            <div class="page-inner"></div>
          </div>

          <!-- Анимированный лист -->
          <div class="sheet" id="sheet" aria-hidden="true">
            <div class="side" data-face="front" id="sheetFront"></div>
            <div class="side" data-face="back" id="sheetBack"></div>
          </div>

          <!-- Зоны захвата для drag-перелистывания -->
          <div class="corner-zone top-right" data-dir="next"></div>
          <div class="corner-zone bottom-right" data-dir="next"></div>
          <div class="corner-zone top-left" data-dir="prev"></div>
          <div class="corner-zone bottom-left" data-dir="prev"></div>

          <!-- Оверлей загрузки -->
          <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
            <div class="loading-progress" id="loadingProgress">Загрузка...</div>
          </div>

          <!-- Измеритель -->
          <div id="measurer"></div>
        </div>
      </div>

      <!-- Панель управления -->
      <div class="controls">
        <div class="navigation">
          <button id="prev">← Назад</button>
          <button id="tocBtn">Содержание</button>
          <button id="next">Вперёд →</button>
          <button id="continueBtn" hidden>Продолжить чтение</button>
          <label>Настройки
            <input class="settings-checkbox" type="checkbox" id="settings-checkbox" />
          </label>
        </div>
        <div class="settings" role="group" aria-label="Настройки чтения">
          <div class="font-size">
            <span>Размер шрифта </span>
            <button id="decrease">−</button>
            <button id="increase">+</button>
          </div>
          <div class="font-choice">
            <label for="font-select">Шрифт:</label>
            <select id="font-select">
              <option value="georgia">Georgia</option>
              <option value="merriweather">Merriweather</option>
              <option value="libre-baskerville">Libre Baskerville</option>
              <option value="inter">Inter</option>
              <option value="roboto">Roboto</option>
              <option value="open-sans">Open Sans</option>
            </select>
          </div>
          <div class="theme-choice">
            <label for="theme-select">Тема:</label>
            <select id="theme-select">
              <option value="light">Светлая</option>
              <option value="dark">Тёмная</option>
              <option value="bw">Ч/б</option>
            </select>
          </div>
          <button id="debugToggle">Debug</button>
        </div>
        <div class="copyright">
          <span>разработка - <a href="https://t.me/layare">@layare</a></span>
          <span>иллюстрации - <a href="https://t.me/nedthird">@nedthird</a></span>
        </div>
      </div>
    </div>

    <!-- ES Module entry point -->
    <script type="module" src="js/index.js"></script>
  </body>
</html>
