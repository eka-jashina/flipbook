<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <title>О хоббитах — Интерактивная книга</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
      default-src 'self';
      script-src 'self';
      style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
      font-src 'self' https://fonts.gstatic.com data:;
      img-src 'self' data: blob:;
      media-src 'self' data:;
      connect-src 'self';
      frame-ancestors 'none';
      base-uri 'self';
      form-action 'none';
    ">

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter&family=Roboto&family=Open+Sans&family=Merriweather&family=Libre+Baskerville&display=swap"
      rel="stylesheet"
    >

    <!-- Предзагрузка -->
    <link rel="preload" fetchpriority="high" as="image" href="images/backgrounds/bg-cover.webp" type="image/webp" media="(min-width: 769px)">
    <link rel="preload" fetchpriority="high" as="image" href="images/backgrounds/bg-cover-mobile.webp" type="image/webp" media="(max-width: 768px)">
    <link rel="preload" href="fonts/tolkiencyr.woff2" as="font" crossorigin="anonymous">

    <!-- Главный CSS (импортирует все модули) -->
    <link rel="stylesheet" href="css/index.css">
  </head>

  <body data-debug="false" data-screen="bookshelf">
    <!-- Skip navigation -->
    <a class="skip-link" href="#book">Перейти к книге</a>

    <!-- Фоновые изображения глав (два слоя для кроссфейда) -->
    <div class="chapter-bg">
      <div class="bg" data-active="false"></div>
      <div class="bg" data-active="false"></div>
    </div>

    <!-- Панель отладки -->
    <div class="debug-info" id="debugInfo">
      <div>State: <span id="debugState">-</span></div>
      <div>Pages: <span id="debugTotal">0</span></div>
      <div>Current: <span id="debugCurrent">0</span></div>
      <div>Cache: <span id="debugCache">0</span></div>
      <div>Memory: <span id="debugMemory">-</span></div>
      <div>Listeners: <span id="debugListeners">0</span></div>
    </div>

    <!-- Error message в HTML-->
    <div class="error-message" id="errorMessage" hidden role="alert">
      <span id="errorText"></span>
    </div>

    <!-- Screen reader announcements (visually hidden) -->
    <div id="sr-announcer" class="sr-only" aria-live="polite" aria-atomic="true" role="status"></div>

    <!--#include "html/partials/reader/landing.html" -->
    <!--#include "html/partials/reader/bookshelf.html" -->

    <main class="scene">
      <!--#include "html/partials/reader/book-container.html" -->
      <!--#include "html/partials/reader/controls.html" -->
    </main>

    <!--#include "html/partials/reader/pwa.html" -->
    <!--#include "html/partials/reader/templates.html" -->

    <!-- ES Module entry point -->
    <script type="module" src="js/index.js"></script>
  </body>
</html>
