# План улучшений UX фотоальбома

## Приоритет 1 — Баги и потеря данных

### 1.1 Исправить filterIntensity (баг рассинхронизации)
**Проблема:** Слайдер интенсивности фильтра работает только в превью админки. В сгенерированном HTML используются CSS-классы (`photo-album__item--filter-sepia`), которые всегда применяют фиксированное значение (например `sepia(0.75)`), игнорируя `filterIntensity`.

**Решение:** В `_buildAlbumHtml()` добавлять inline `style="--filter-intensity: 0.3"` (или прямой `style="filter: sepia(0.3)"`) на `<figure>`, а в `photo-album.css` использовать CSS-переменную для вычисления. Альтернативно — `_computeFilterStyle()` уже есть, использовать его результат как inline style на `<img>`.

**Файлы:**
- `js/admin/modules/AlbumManager.js` — `_buildAlbumHtml()`, `_buildItemModifiers()`
- `css/photo-album.css` — фильтры (строки ~272-290)

### 1.2 Подтверждение при смене раскладки с потерей фото
**Проблема:** Переключение с layout "4" на "2" молча удаляет 2 последних фото (`page.images.slice(0, count)`).

**Решение:** Перед обрезкой массива проверять, есть ли данные в удаляемых слотах. Если да — показать confirm-диалог. Использовать `this._module._confirm()` (уже есть в ChaptersModule).

**Файлы:**
- `js/admin/modules/AlbumManager.js` — `_selectPageLayout()`

### 1.3 Подтверждение выхода с несохранёнными изменениями
**Проблема:** Кнопка "Отмена" и "Назад" мгновенно уходят со страницы без предупреждения.

**Решение:** Отслеживать флаг `_isDirty` (ставить при любом изменении: загрузка фото, смена раскладки, ввод подписи и т.д.). При выходе, если `_isDirty === true`, показать confirm.

**Файлы:**
- `js/admin/modules/AlbumManager.js` — `_cancelAlbum()`, добавить `_isDirty` трекинг

### 1.4 Валидация пустых слотов перед сохранением
**Проблема:** Если выбрана раскладка "4", но загружено только 2 фото — в HTML генерируются пустые `<figure>` с `src=""`, которые отображаются как broken image.

**Решение:** Два варианта:
- (a) Предупреждать пользователя о незаполненных слотах при сохранении
- (b) Не генерировать `<figure>` для пустых слотов, а в CSS обработать уменьшенное количество элементов

**Файлы:**
- `js/admin/modules/AlbumManager.js` — `_handleAlbumSubmit()`, `_buildAlbumHtml()`

---

## Приоритет 2 — Ключевые UX-фичи

### 2.1 Навигация между фото в лайтбоксе
**Проблема:** Лайтбокс открывает одно фото без возможности перелистывания. Для альбома это критичный паттерн.

**Решение:** При открытии лайтбокса собрать массив всех `.photo-album__item img` в текущем контексте. Добавить стрелки влево/вправо, поддержку клавиш `←`/`→`, и свайп на мобильных.

**Файлы:**
- `js/utils/PhotoLightbox.js` — `open()`, `attach()`, добавить `_images[]`, `_currentIndex`, `next()`, `prev()`
- `css/photo-album.css` — стили для стрелок навигации

### 2.2 Drag & Drop загрузка фотографий
**Проблема:** Только клик → file picker. Для фотоальбома D&D — ожидаемый паттерн.

**Решение:** Добавить обработчики `dragover`/`drop` на каждый слот. При drop валидировать файл и обрабатывать. Визуальная индикация дропзоны (подсветка слота).

**Файлы:**
- `js/admin/modules/AlbumManager.js` — `_renderPageImageSlots()`
- `css/admin/album.css` — стиль `.album-image-slot.drag-over`

### 2.3 Индикатор загрузки при сжатии изображения
**Проблема:** Нет визуальной обратной связи во время `_compressImage()`.

**Решение:** Показывать spinner/progress bar в слоте на время обработки. Добавить класс `.loading` на слот, CSS-анимация.

**Файлы:**
- `js/admin/modules/AlbumManager.js` — `_readPageImageFile()`
- `css/admin/album.css` — `.album-image-slot.loading`

---

## Приоритет 3 — Улучшения удобства

### 3.1 Сохранение позиции скролла при перерисовке
**Проблема:** `_renderAlbumPages()` делает `innerHTML = ''` и пересоздаёт весь DOM — скролл и фокус теряются.

**Решение:** Запоминать `scrollTop` перед перерисовкой и восстанавливать после. Для фокуса — запоминать `data-*` атрибуты активного элемента и восстанавливать фокус.

**Файлы:**
- `js/admin/modules/AlbumManager.js` — `_renderAlbumPages()`

### 3.2 Сохранение оригинала при кадрировании
**Проблема:** Кадрирование заменяет `dataUrl` — оригинал теряется навсегда.

**Решение:** Хранить `originalDataUrl` в объекте изображения. При повторном кадрировании — кадрировать из оригинала. Кнопка "Сбросить кадрирование" для возврата к оригиналу.

**Файлы:**
- `js/admin/modules/AlbumManager.js` — `_cropPageImage()`, `_readPageImageFile()`, структура данных image

### 3.3 Увеличить область кнопок на миниатюре
**Проблема:** 22x22px — ниже рекомендаций WCAG (44x44px) для touch targets.

**Решение:** Увеличить визуальный размер до 28-32px, touch-area до 44px через padding/margin. На мобильных — вынести кнопки под миниатюру в строку.

**Файлы:**
- `css/admin/album.css` — `.album-image-slot-remove/crop/rotate`

### 3.4 Переупорядочивание страниц альбома
**Проблема:** Нельзя изменить порядок страниц после создания.

**Решение:** Добавить кнопки "вверх/вниз" в заголовок каждой страницы (по аналогии с главами в `ChaptersModule`). Drag-and-drop страниц — как отдельное улучшение.

**Файлы:**
- `js/admin/modules/AlbumManager.js` — `_renderAlbumPages()`, добавить `_movePageUp()`, `_movePageDown()`

---

## Приоритет 4 — Полировка

### 4.1 Предпросмотр альбома перед сохранением
**Решение:** Кнопка "Предпросмотр" рядом с "Добавить альбом". Генерирует HTML через `_buildAlbumHtml()` и показывает в модальном окне с CSS из `photo-album.css`.

### 4.2 Расширенное поле подписи
**Решение:** Заменить `<input>` на `<textarea>` с автовысотой или увеличить ширину input до ширины слота. Добавить счётчик символов (опционально).

### 4.3 Адаптивность редактора альбома для мобильных
**Решение:** В `css/admin/responsive.css` добавить правила для album-editor: слоты в колонку, увеличенные кнопки, адаптивные layouts.

### 4.4 Массовая загрузка фотографий
**Решение:** Добавить кнопку "Загрузить несколько фото" на уровне страницы. `input[multiple]` → автозаполнение свободных слотов по порядку. Если фото больше, чем слотов — автоматическое создание новых страниц.

### 4.5 Значение hideTitle по умолчанию
**Решение:** Изменить дефолт на `checked = false` (заголовок виден). Это более предсказуемое поведение — пользователь вводит название и ожидает его увидеть.
